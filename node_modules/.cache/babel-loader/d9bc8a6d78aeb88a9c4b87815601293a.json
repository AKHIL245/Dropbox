{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Checkout\\\\Desktop\\\\Dropbox\\\\src\\\\components\\\\UserPage.jsx\";\nimport React, { PureComponent } from 'react';\nimport { Button, Navbar, Table } from \"react-bootstrap\";\nimport { dataService } from '../services/dataService';\nimport FileUpload from './FileUpload';\nimport LogOut from './LogOut';\nimport LogInPage from './LogInPage';\n\nvar jwt = require('jsonwebtoken');\n\nglobal.fetch = require('node-fetch');\n\nvar AWSCognito = require('amazon-cognito-identity-js');\n\nclass UserPage extends PureComponent {\n  constructor(props) {\n    super(props);\n    global.fetch = require('node-fetch');\n\n    var AWSCognito = require('amazon-cognito-identity-js');\n\n    const sessionToken = sessionStorage.getItem(\"token\"); // JWT DECODE \n    // Store decoded jwt in session storage\n\n    this.state = {\n      userDataDynamo: [],\n      userData: undefined,\n      desc: \"\",\n      isAdmin: false\n    };\n    this.setDescription = this.setDescription.bind(this);\n    this.updateTable = this.updateTable.bind(this);\n  }\n\n  setDescription(d) {\n    this.setState({\n      desc: d\n    });\n  }\n\n  updateTable2(user) {\n    console.log(\"Called Update Table\");\n    dataService.getUserData(user).then(json => {\n      console.log(json);\n\n      if (Array.isArray(json)) {\n        this.setState({\n          userDataDynamo: json\n        });\n      }\n    }).catch(reason => {\n      console.log(\"Failed to fetch data from server, reason is : \", reason);\n    });\n  }\n\n  updateTable() {\n    console.log(\"Called Update Table\");\n    dataService.getAdminData().then(json => {\n      console.log(json);\n\n      if (Array.isArray(json)) {\n        this.setState({\n          userDataDynamo: json\n        });\n      }\n    }).catch(reason => {\n      console.log(\"Failed to fetch data from server, reason is : \", reason);\n    });\n  }\n\n  componentDidMount() {\n    console.log(\"sessionStorage\");\n    var token = sessionStorage.getItem(\"token\");\n    console.log(token);\n    var decoded = jwt.decode(token); // get the decoded payload and header\n\n    var decoded = jwt.decode(token, {\n      complete: true\n    });\n    console.log(decoded.header);\n    console.log(decoded.payload);\n    const userObj = decoded.payload;\n    this.setState({\n      userData: userObj\n    });\n    const isAdmin = userObj && userObj[\"cognito:groups\"] && userObj[\"cognito:groups\"].filter(g => g == \"admin\").length > 0;\n    this.setState({\n      isAdmin\n    });\n    setTimeout(() => {\n      console.log(\"UserEmailCheckBefore:\" + this.state.userData.email);\n      console.log(\"isAdmin:\" + this.state.isAdmin);\n\n      if (this.state.isAdmin) {\n        this.updateTable();\n      } else {\n        this.updateTable2(this.state.userData.email);\n      }\n    }, 500);\n    dataService.getUser();\n  }\n\n  onClickDownLoad(file) {\n    window.open(\"https://d2k9a10np1c61w.cloudfront.net/\" + file);\n  }\n\n  onClickDelete(fileName, id) {\n    dataService.deleteFile(fileName, id).then(json => {\n      console.log(json);\n      setTimeout(() => {\n        if (this.state.isAdmin) {\n          this.updateTable();\n        } else {\n          this.updateTable2(this.state.userData.email);\n        }\n      }, 300);\n    }).catch(reason => {\n      console.log(\"Failed to delete, reason is : \", reason);\n    });\n  } // fetchListAgain\n\n\n  render() {\n    const isAdmin = this.state.isAdmin;\n    return React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 130\n      },\n      __self: this\n    }, React.createElement(\"h1\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 131\n      },\n      __self: this\n    }, \"Anil\"), React.createElement(Navbar, {\n      bg: \"dark\",\n      variant: \"dark\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 132\n      },\n      __self: this\n    }, React.createElement(Navbar.Brand, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 133\n      },\n      __self: this\n    }, \"DropBucket\"), React.createElement(Navbar.Collapse, {\n      className: \"justify-content-end\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 134\n      },\n      __self: this\n    }, React.createElement(Navbar.Text, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 135\n      },\n      __self: this\n    }, \"Signed in as: \", this.state.userData && React.createElement(\"a\", {\n      href: \"#login\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 137\n      },\n      __self: this\n    }, this.state.userData.email), \"\\xA0\\xA0 User Type: \", isAdmin && React.createElement(\"a\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 140\n      },\n      __self: this\n    }, \" \\\"Administrator\\\" \"), !isAdmin && React.createElement(\"a\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 143\n      },\n      __self: this\n    }, \" \\\"User (Non Admin)\\\"\"))), this.state.userData && React.createElement(LogOut, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 147\n      },\n      __self: this\n    }), !this.state.userData && React.createElement(LogInPage, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 148\n      },\n      __self: this\n    })), this.state.userData && React.createElement(FileUpload, {\n      user: this.state.userData.email,\n      desc: this.state.desc,\n      refreshList: e => this.updateTable(),\n      refreshList2: e => this.updateTable2(e),\n      isAdmin: isAdmin,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 152\n      },\n      __self: this\n    }), React.createElement(\"div\", {\n      style: {\n        \"margin\": \"50px\"\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 163\n      },\n      __self: this\n    }, React.createElement(Table, {\n      striped: true,\n      bordered: true,\n      hover: true,\n      responsive: true,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 164\n      },\n      __self: this\n    }, React.createElement(\"thead\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 165\n      },\n      __self: this\n    }, React.createElement(\"tr\", {\n      key: 0,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 166\n      },\n      __self: this\n    }, isAdmin && React.createElement(\"th\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 169\n      },\n      __self: this\n    }, \"User Name\"), React.createElement(\"th\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 172\n      },\n      __self: this\n    }, \"File Name\"), React.createElement(\"th\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 173\n      },\n      __self: this\n    }, \"Description\"), React.createElement(\"th\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 174\n      },\n      __self: this\n    }, \"File Upload Time\"), React.createElement(\"th\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 175\n      },\n      __self: this\n    }, \"File Updated Time\"), React.createElement(\"th\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 176\n      },\n      __self: this\n    }, \"Download\"), React.createElement(\"th\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 177\n      },\n      __self: this\n    }, \"Delete\"))), React.createElement(\"tbody\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 180\n      },\n      __self: this\n    }, this.state.userDataDynamo.map(item => {\n      return React.createElement(\"tr\", {\n        key: item.userId,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 184\n        },\n        __self: this\n      }, isAdmin && React.createElement(\"td\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 187\n        },\n        __self: this\n      }, item.userName), React.createElement(\"td\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 190\n        },\n        __self: this\n      }, item.fileName), React.createElement(\"td\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 191\n        },\n        __self: this\n      }, item.description), React.createElement(\"td\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 192\n        },\n        __self: this\n      }, new Date(item.fileCreatedTime).toLocaleString()), React.createElement(\"td\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 193\n        },\n        __self: this\n      }, new Date(item.fileUpdatedTime).toLocaleString()), React.createElement(\"td\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 194\n        },\n        __self: this\n      }, React.createElement(Button, {\n        variant: \"outline-success\",\n        onClick: event => this.onClickDownLoad(item.fileName),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 194\n        },\n        __self: this\n      }, React.createElement(\"a\", {\n        href: \"https://d3k2ba7dd5osnx.cloudfront.net/\" + item.fileName,\n        target: \"_blank\",\n        download: item.fileName,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 195\n        },\n        __self: this\n      }, \"DownLoad\"))), React.createElement(\"td\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 197\n        },\n        __self: this\n      }, React.createElement(Button, {\n        variant: \"outline-danger\",\n        onClick: event => this.onClickDelete(item.fileName, item.userId),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 197\n        },\n        __self: this\n      }, \"Delete\")));\n    })))));\n  }\n\n}\n\nexport default UserPage;","map":{"version":3,"sources":["C:/Users/Checkout/Desktop/Dropbox/src/components/UserPage.jsx"],"names":["React","PureComponent","Button","Navbar","Table","dataService","FileUpload","LogOut","LogInPage","jwt","require","global","fetch","AWSCognito","UserPage","constructor","props","sessionToken","sessionStorage","getItem","state","userDataDynamo","userData","undefined","desc","isAdmin","setDescription","bind","updateTable","d","setState","updateTable2","user","console","log","getUserData","then","json","Array","isArray","catch","reason","getAdminData","componentDidMount","token","decoded","decode","complete","header","payload","userObj","filter","g","length","setTimeout","email","getUser","onClickDownLoad","file","window","open","onClickDelete","fileName","id","deleteFile","render","e","map","item","userId","userName","description","Date","fileCreatedTime","toLocaleString","fileUpdatedTime","event"],"mappings":"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","sourcesContent":["import React, { PureComponent } from 'react'\r\nimport { Button, Navbar, Table } from \"react-bootstrap\";\r\nimport { dataService } from '../services/dataService';\r\nimport FileUpload from './FileUpload';\r\nimport LogOut from './LogOut';\r\nimport LogInPage from './LogInPage';\r\nvar jwt = require('jsonwebtoken');\r\nglobal.fetch = require('node-fetch');\r\nvar AWSCognito = require('amazon-cognito-identity-js');\r\n\r\nclass UserPage extends PureComponent {\r\n    constructor(props) {\r\n        super(props)\r\n        global.fetch = require('node-fetch');\r\n        var AWSCognito = require('amazon-cognito-identity-js');\r\n        const sessionToken = sessionStorage.getItem(\"token\")\r\n        // JWT DECODE \r\n        // Store decoded jwt in session storage\r\n\r\n        this.state = {\r\n            userDataDynamo: [],\r\n            userData: undefined,\r\n            desc: \"\",\r\n            isAdmin: false\r\n        }\r\n        this.setDescription = this.setDescription.bind(this)\r\n        this.updateTable = this.updateTable.bind(this)\r\n    }\r\n\r\n    setDescription(d) {\r\n        this.setState({\r\n            desc: d\r\n        })\r\n    }\r\n\r\n    updateTable2(user) {\r\n        console.log(\"Called Update Table\");\r\n        dataService.getUserData(user)\r\n            .then(json => {\r\n                console.log(json);\r\n                if (Array.isArray(json)) {\r\n                    this.setState({\r\n                        userDataDynamo: json\r\n                    });\r\n                }\r\n            })\r\n            .catch(reason => {\r\n                console.log(\"Failed to fetch data from server, reason is : \", reason);\r\n            });\r\n    }\r\n    updateTable() {\r\n        console.log(\"Called Update Table\");\r\n        dataService.getAdminData()\r\n            .then(json => {\r\n                console.log(json);\r\n                if (Array.isArray(json)) {\r\n                    this.setState({\r\n                        userDataDynamo: json\r\n                    });\r\n                }\r\n            })\r\n            .catch(reason => {\r\n                console.log(\"Failed to fetch data from server, reason is : \", reason);\r\n            });\r\n    }\r\n    componentDidMount() {\r\n        console.log(\"sessionStorage\");\r\n        var token = sessionStorage.getItem(\"token\");\r\n        console.log(token);\r\n        var decoded = jwt.decode(token);\r\n        // get the decoded payload and header\r\n        var decoded = jwt.decode(token, { complete: true });\r\n        console.log(decoded.header);\r\n        console.log(decoded.payload);\r\n        const userObj = decoded.payload;\r\n        this.setState({\r\n            userData: userObj\r\n        })\r\n        const isAdmin = userObj && userObj[\"cognito:groups\"] && userObj[\"cognito:groups\"].filter(g => g == \"admin\").length > 0;\r\n\r\n        this.setState({ isAdmin });\r\n        setTimeout(()=> {\r\n            console.log(\"UserEmailCheckBefore:\"+this.state.userData.email)\r\n            console.log(\"isAdmin:\"+this.state.isAdmin)\r\n            if (this.state.isAdmin){\r\n                this.updateTable()\r\n            } else {\r\n                this.updateTable2(this.state.userData.email);\r\n            }\r\n        }, 500);\r\n        \r\n      \r\n        dataService.getUser()\r\n    }\r\n    \r\n\r\n    onClickDownLoad(file) {\r\n        window.open(\"https://d2k9a10np1c61w.cloudfront.net/\" + file);\r\n    }\r\n\r\n    onClickDelete(fileName, id) {\r\n        dataService.deleteFile(fileName, id)\r\n            .then(json => {\r\n                console.log(json);\r\n                setTimeout(()=> {\r\n                if (this.state.isAdmin){\r\n                    this.updateTable()\r\n                } else {\r\n                    this.updateTable2(this.state.userData.email);\r\n                }\r\n            }, 300);\r\n                \r\n            })\r\n            .catch(reason => {\r\n                console.log(\"Failed to delete, reason is : \", reason);\r\n            });\r\n    }\r\n\r\n    // fetchListAgain\r\n\r\n\r\n\r\n\r\n    render() {\r\n\r\n        const { isAdmin } = this.state;\r\n\r\n        return (\r\n\r\n            <div>\r\n                <h1>Anil</h1>\r\n                <Navbar bg=\"dark\" variant=\"dark\">\r\n                    <Navbar.Brand>DropBucket</Navbar.Brand>\r\n                    <Navbar.Collapse className=\"justify-content-end\">\r\n                        <Navbar.Text>\r\n                            Signed in as: {this.state.userData &&\r\n                                <a href=\"#login\">{this.state.userData.email}</a>}\r\n                            &nbsp;&nbsp;\r\n                            User Type: {\r\n                                isAdmin && <a> \"Administrator\" </a>\r\n                            }\r\n                            {\r\n                                !isAdmin && <a> \"User (Non Admin)\"</a>\r\n                            }\r\n                        </Navbar.Text>\r\n                    </Navbar.Collapse>\r\n                    {this.state.userData && <LogOut></LogOut>}\r\n                    {!this.state.userData && <LogInPage></LogInPage>}\r\n                </Navbar>\r\n                {\r\n                    this.state.userData &&\r\n                    <FileUpload\r\n                        user={this.state.userData.email}\r\n                        desc={this.state.desc}\r\n                        refreshList={e => this.updateTable()}\r\n                        refreshList2={e => this.updateTable2(e)}\r\n                        isAdmin={isAdmin}\r\n                    >\r\n                    </FileUpload>\r\n                }\r\n\r\n\r\n                <div style={{ \"margin\": \"50px\" }}>\r\n                    <Table striped bordered hover responsive>\r\n                        <thead>\r\n                            <tr key={0}>\r\n                                {\r\n                                    isAdmin &&\r\n                                    <th>User Name</th>\r\n                                }\r\n\r\n                                <th>File Name</th>\r\n                                <th>Description</th>\r\n                                <th>File Upload Time</th>\r\n                                <th>File Updated Time</th>\r\n                                <th>Download</th>\r\n                                <th>Delete</th>\r\n                            </tr>\r\n                        </thead>\r\n                        <tbody>\r\n                            {\r\n                                this.state.userDataDynamo.map(item => {\r\n                                    return (\r\n                                        <tr key={item.userId}>\r\n                                            {\r\n                                                isAdmin &&\r\n                                                <td>{item.userName}</td>\r\n                                            }\r\n\r\n                                            <td>{item.fileName}</td>\r\n                                            <td>{item.description}</td>\r\n                                            <td>{new Date(item.fileCreatedTime).toLocaleString()}</td>\r\n                                            <td>{new Date(item.fileUpdatedTime).toLocaleString()}</td>\r\n                                            <td><Button variant=\"outline-success\" onClick={event => this.onClickDownLoad(item.fileName)}>\r\n                                                <a href={\"https://d3k2ba7dd5osnx.cloudfront.net/\" + item.fileName} target=\"_blank\" download={item.fileName}>DownLoad</a>\r\n                                            </Button></td>\r\n                                            <td><Button variant=\"outline-danger\" onClick={event => this.onClickDelete(item.fileName, item.userId)}>\r\n                                                Delete\r\n                                            </Button></td>\r\n                                        </tr>\r\n\r\n                                    );\r\n                                })\r\n                            }\r\n\r\n                        </tbody>\r\n                    </Table>\r\n                </div>\r\n\r\n            </div>\r\n\r\n        )\r\n    }\r\n}\r\n\r\nexport default UserPage"]},"metadata":{},"sourceType":"module"}